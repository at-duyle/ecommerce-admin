!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t("object"==typeof exports?require("jquery"):jQuery)}(function(t){"use strict";function i(t){return"number"==typeof t}function e(t){return"string"==typeof t}function h(t){return void 0===t}function s(t,e){var h=[];return i(e)&&h.push(e),h.slice.apply(t,h)}function a(t,i){var e=s(arguments,2);return function(){return t.apply(i,e.concat(s(arguments)))}}function o(t){var i=t.match(/^(https?:)\/\/([^\:\/\?#]+):?(\d*)/i);return!(!i||i[1]===f.protocol&&i[2]===f.hostname&&i[3]===f.port)}function r(t){var i="timestamp="+(new Date).getTime();return t+(-1===t.indexOf("?")?"?":"&")+i}function n(t){return t?"rotate("+t+"deg)":"none"}function d(t){var i=j(t.degree)%180,e=(i>90?180-i:i)*Math.PI/180;return{width:t.width*A(e)+t.height*O(e),height:t.width*O(e)+t.height*A(e)}}function p(i,e){var h=t("<canvas>")[0],s=h.getContext("2d"),a=e.naturalWidth,o=e.naturalHeight,r=e.rotate,n=d({width:a,height:o,degree:r});return r?(h.width=n.width,h.height=n.height,s.save(),s.translate(n.width/2,n.height/2),s.rotate(r*Math.PI/180),s.drawImage(i,-a/2,-o/2,a,o),s.restore()):(h.width=a,h.height=o,s.drawImage(i,0,0,a,o)),h}function c(i,e){this.$element=t(i),this.options=t.extend({},c.DEFAULTS,t.isPlainObject(e)&&e),this.ready=!1,this.built=!1,this.cropped=!1,this.disabled=!1,this.load()}var l=t(window),g=t(document),f=window.location,u="directive",m=".cropper",v=/^(e|n|w|s|ne|nw|sw|se|all|crop|move|zoom)$/,w="cropper-modal",x="cropper-hide",b="cropper-hidden",y="cropper-crop",C="cropper-disabled",$="mousedown touchstart",D="mousemove touchmove",B="mouseup mouseleave touchend touchleave touchcancel",k="wheel mousewheel DOMMouseScroll",W="dblclick",I="resize"+m,Y="build"+m,H="built"+m,X="dragstart"+m,z="dragmove"+m,L="dragend"+m,T={canvas:t.isFunction(t("<canvas>")[0].getContext)},M=Math.round,R=Math.sqrt,E=Math.min,P=Math.max,j=Math.abs,O=Math.sin,A=Math.cos,F=parseFloat,N={};N.load=function(){var i,e,h,s=this,a=this.options,n=this.$element,d="";n.is("img")?h=n.prop("src"):n.is("canvas")&&T.canvas&&(h=n[0].toDataURL()),h&&(i=t.Event(Y),n.one(Y,a.build).trigger(i),i.isDefaultPrevented()||(a.checkImageOrigin&&o(h)&&(d=" crossOrigin",h=r(h)),this.$clone=e=t("<img"+d+' src="'+h+'">'),e.one("load",function(){var t=this.naturalWidth||e.width(),i=this.naturalHeight||e.height();s.image={naturalWidth:t,naturalHeight:i,aspectRatio:t/i,rotate:0},s.url=h,s.ready=!0,s.build()}),e.addClass(x).prependTo("body")))},N.build=function(){var i,e,h=this.$element,s=this.options;this.ready&&(this.built&&this.unbuild(),this.$cropper=i=t(c.TEMPLATE),h.addClass(b),this.$clone.removeClass(x).prependTo(i),this.$container=h.parent(),this.$container.append(i),this.$canvas=i.find(".cropper-canvas"),this.$cropBox=e=i.find(".cropper-cropbox"),this.$viewer=i.find(".cropper-viewer"),this.addListeners(),this.initPreview(),s.aspectRatio=j(F(s.aspectRatio))||NaN,s.autoCrop?(this.cropped=!0,s.modal&&this.$canvas.addClass(w)):e.addClass(b),s.background&&i.addClass("cropper-bg"),!s.highlight&&e.find(".cropper-face").addClass("cropper-invisible"),!s.guides&&e.find(".cropper-dashed").addClass(b),!s.movable&&e.find(".cropper-face").data(u,"move"),!s.resizable&&e.find(".cropper-line, .cropper-point").addClass(b),this.setDragMode(s.dragCrop?"crop":"move"),this.built=!0,this.render(),h.one(H,s.built).trigger(H))},N.unbuild=function(){this.built&&(this.built=!1,this.removeListeners(),this.$preview.empty(),this.$preview=null,this.$cropBox=null,this.$canvas=null,this.$container=null,this.$cropper.remove(),this.$cropper=null)},t.extend(N,{render:function(){this.initContainer(),this.initImage(),this.initCropBox()},initContainer:function(){var t=this.$element,i=this.$container,e=this.$cropper,h=this.options;e.addClass(b),t.removeClass(b),e.css(this.container={width:P(i.width(),F(h.minContainerWidth)||350),height:P(i.height(),F(h.minContainerHeight)||150)}),t.addClass(b),e.removeClass(b)},initImage:function(){var i=this.container,e=this.image,h=e.aspectRatio,s=i.width,a=i.height,o=e.naturalWidth,r=e.naturalHeight,n=0,d=0;a*h>s?(o=s,r=o/h,d=(a-r)/2):(r=a,o=r*h,n=(s-o)/2),t.extend(e,{width:o,height:r,left:n,top:d}),this.defaultImage=t.extend({},e),this.renderImage()},renderImage:function(i){var e,h=this.options,s=this.image,a=s.width,o=s.height,r=s.rotate;r&&(e=d({width:a,height:o,degree:r})),t.extend(s,{rotatedWidth:e?e.width:s.width,rotatedHeight:e?e.height:s.height,rotatedLeft:e?s.left-(e.width-a)/2:s.left,rotatedTop:e?s.top-(e.height-o)/2:s.top}),this.$clone.css({width:a,height:o,marginLeft:s.left,marginTop:s.top,transform:n(r)}),i&&(this.preview(),t.isFunction(h.crop)&&h.crop.call(this.$element,this.getData()))},initCropBox:function(){var i=this.options,e=this.container,h=this.image,s=i.aspectRatio,a=e.width,o=e.height,r=j(F(i.minCropBoxWidth))||0,n=j(F(i.minCropBoxHeight))||0,d=j(F(i.autoCropArea))||.8,p={width:h.width,height:h.height,minWidth:r,minHeight:n,maxWidth:a,maxHeight:o};s&&(o*s>a?(p.height=p.width/s,p.maxHeight=a/s):(p.width=h.height*s,p.maxWidth=o*s),r?p.minHeight=p.minWidth/s:n&&(p.minWidth=p.minHeight*s)),p.minWidth=E(p.maxWidth,p.minWidth),p.minHeight=E(p.maxHeight,p.minHeight),p.width=P(p.minWidth,p.width*d),p.height=P(p.minHeight,p.height*d),p.left=(a-p.width)/2,p.top=(o-p.height)/2,p.oldLeft=p.left,p.oldTop=p.top,this.defaultCropBox=t.extend({},p),this.cropBox=p,this.cropped&&this.renderCropBox()},renderCropBox:function(){var i=this.options,e=this.container,h=this.$cropBox,s=this.cropBox;s.width>s.maxWidth?(s.width=s.maxWidth,s.left=s.oldLeft):s.width<s.minWidth&&(s.width=s.minWidth,s.left=s.oldLeft),s.height>s.maxHeight?(s.height=s.maxHeight,s.top=s.oldTop):s.height<s.minHeight&&(s.height=s.minHeight,s.top=s.oldTop),s.left=E(P(s.left,0),e.width-s.width),s.top=E(P(s.top,0),e.height-s.height),s.oldLeft=s.left,s.oldTop=s.top,i.movable&&h.find(".cropper-face").data(u,s.width===e.width&&s.height===e.height?"move":"all"),h.css({width:s.width,height:s.height,left:s.left,top:s.top}),this.disabled||(this.preview(),t.isFunction(i.crop)&&i.crop.call(this.$element,this.getData()))}}),N.initPreview=function(){var i=this.url;this.$preview=t(this.options.preview),this.$viewer.html('<img src="'+i+'">'),this.$preview.each(function(){var e=t(this);e.data({width:e.width(),height:e.height()}).html('<img src="'+i+'" style="display:block;width:100%;min-width:0!important;min-height:0!important;max-width:none!important;max-height:none!important;">')})},N.preview=function(){var i=this.image,e=this.cropBox,h=i.width,s=i.height,a=e.left-i.left,o=e.top-i.top,r=i.rotate;this.cropped&&!this.disabled&&(this.$viewer.find("img").css({width:h,height:s,marginLeft:-a,marginTop:-o,transform:n(r)}),this.$preview.each(function(){var i=t(this),d=i.data(),p=d.width/e.width,c=d.width,l=e.height*p;l>d.height&&(p=d.height/e.height,c=e.width*p,l=d.height),i.width(c).height(l).find("img").css({width:h*p,height:s*p,marginLeft:-a*p,marginTop:-o*p,transform:n(r)})}))},N.addListeners=function(){var i=this.options;this.$element.on(X,i.dragstart).on(z,i.dragmove).on(L,i.dragend),this.$cropper.on($,t.proxy(this.dragstart,this)).on(W,t.proxy(this.dblclick,this)),i.zoomable&&i.mouseWheelZoom&&this.$cropper.on(k,t.proxy(this.wheel,this)),i.global?g.on(D,this._dragmove=a(this.dragmove,this)).on(B,this._dragend=a(this.dragend,this)):this.$cropper.on(D,t.proxy(this.dragmove,this)).on(B,t.proxy(this.dragend,this)),i.responsive&&l.on(I,this._resize=a(this.resize,this))},N.removeListeners=function(){var t=this.options;this.$element.off(X,t.dragstart).off(z,t.dragmove).off(L,t.dragend),this.$cropper.off($,this.dragstart).off(W,this.dblclick),t.zoomable&&t.mouseWheelZoom&&this.$cropper.off(k,this.wheel),t.global?g.off(D,this._dragmove).off(B,this._dragend):this.$cropper.off(D,this.dragmove).off(B,this.dragend),t.responsive&&l.off(I,this._resize)},t.extend(N,{resize:function(){var i=this.$container,e=this.container;this.disabled||(i.width()!==e.width||i.height()!==e.height)&&(clearTimeout(this.resizing),this.resizing=setTimeout(t.proxy(function(){var t=this.getImageData(),i=this.getCropBoxData();this.render(),this.setImageData(t),this.setCropBoxData(i)},this),200))},dblclick:function(){this.disabled||this.setDragMode(this.$canvas.hasClass(y)?"move":"crop")},wheel:function(t){var i=t.originalEvent,e=1;this.disabled||(t.preventDefault(),i.deltaY?e=i.deltaY>0?1:-1:i.wheelDelta?e=-i.wheelDelta/120:i.detail&&(e=i.detail>0?1:-1),this.zoom(.1*e))},dragstart:function(i){var e,h,s,a=this.options,o=i.originalEvent,r=o&&o.touches,n=i;if(!this.disabled){if(r){if((s=r.length)>1){if(!a.zoomable||!a.touchDragZoom||2!==s)return;n=r[1],this.startX2=n.pageX,this.startY2=n.pageY,e="zoom"}n=r[0]}if(e=e||t(n.target).data(u),v.test(e)){if(i.preventDefault(),h=t.Event(X),this.$element.trigger(h),h.isDefaultPrevented())return;this.directive=e,this.cropping=!1,this.startX=n.pageX,this.startY=n.pageY,"crop"===e&&(this.cropping=!0,this.$canvas.addClass(w))}}},dragmove:function(i){var e,h,s=this.options,a=i.originalEvent,o=a&&a.touches,r=i;if(!this.disabled){if(o){if((h=o.length)>1){if(!s.zoomable||!s.touchDragZoom||2!==h)return;r=o[1],this.endX2=r.pageX,this.endY2=r.pageY}r=o[0]}if(this.directive){if(i.preventDefault(),e=t.Event(z),this.$element.trigger(e),e.isDefaultPrevented())return;this.endX=r.pageX,this.endY=r.pageY,this.change()}}},dragend:function(i){var e;if(!this.disabled&&this.directive){if(i.preventDefault(),e=t.Event(L),this.$element.trigger(e),e.isDefaultPrevented())return;this.cropping&&(this.cropping=!1,this.$canvas.toggleClass(w,this.cropped&&this.options.modal)),this.directive=""}}}),t.extend(N,{reset:function(){this.cropped&&!this.disabled&&(this.image=t.extend({},this.defaultImage),this.renderImage(),this.cropBox=t.extend({},this.defaultCropBox),this.renderCropBox())},clear:function(){var t=this.cropBox;this.cropped&&!this.disabled&&(this.cropped=!1,t.left=0,t.top=0,t.width=0,t.height=0,this.renderCropBox(),this.$canvas.removeClass(w),this.$cropBox.addClass(b))},destroy:function(){var t=this.$element;this.ready||this.$clone.off("load").remove(),this.unbuild(),t.removeClass(b).removeData("cropper")},replace:function(i){var e,h,s=this,a=this.$element;!this.disabled&&i&&i!==this.url&&i!==a.attr("src")&&(a.is("img")?(a.attr("src",i),this.load()):a.is("canvas")&&T.canvas&&(e=a[0],h=e.getContext("2d"),t('<img src="'+i+'"">').one("load",function(){e.width=this.width,e.height=this.height,h.clearRect(0,0,e.width,e.height),h.drawImage(this,0,0),s.load()})))},enable:function(){this.built&&(this.disabled=!1,this.$cropper.removeClass(C))},disable:function(){this.built&&(this.disabled=!0,this.$cropper.addClass(C))},move:function(t,e){var h=this.image;!this.disabled&&i(t)&&i(e)&&(h.left+=t,h.top+=e,this.renderImage(!0))},zoom:function(t){var i,e,h=this.image;(t=F(t))&&this.built&&!this.disabled&&this.options.zoomable&&(t=-1>=t?1/(1-t):1>=t?1+t:t,i=h.width*t,e=h.height*t,h.left-=(i-h.width)/2,h.top-=(e-h.height)/2,h.width=i,h.height=e,this.renderImage(!0),this.setDragMode("move"))},rotate:function(t){var i=this.image;0!==(t=F(t)||0)&&this.built&&!this.disabled&&this.options.rotatable&&(i.rotate=(i.rotate+t)%360,this.renderImage(!0))},getData:function(i){var e,h,s=this.cropBox,a=this.image,o=a.rotate;return this.built&&this.cropped?(h={x:s.left-(o?a.rotatedLeft:a.left),y:s.top-(o?a.rotatedTop:a.top),width:s.width,height:s.height},e=a.width/a.naturalWidth,t.each(h,function(t,s){s/=e,h[t]=i?M(s):s}),h.rotate=o):h={x:0,y:0,width:0,height:0,rotate:o},h},getImageData:function(i){var e=this.image,h={};return this.built&&t.extend(h,i?e:{left:e.left,top:e.top,width:e.width,height:e.height}),h},setImageData:function(e){var h=this.image;this.built&&!this.disabled&&t.isPlainObject(e)&&(i(e.left)&&(h.left=e.left),i(e.top)&&(h.top=e.top),i(e.width)?(h.width=e.width,h.height=h.width/h.aspectRatio):i(e.height)&&(h.height=e.height,h.width=h.height*h.aspectRatio),this.renderImage(!0))},getCropBoxData:function(){var t,i={};return this.cropped&&(t=this.cropBox,i={left:t.left,top:t.top,width:t.width,height:t.height}),i},setCropBoxData:function(e){var h=this.cropBox,s=this.options.aspectRatio;this.cropped&&!this.disabled&&t.isPlainObject(e)&&(i(e.left)&&(h.left=e.left),i(e.top)&&(h.top=e.top),s?i(e.width)?(h.width=e.width,h.height=h.width/s):i(e.height)&&(h.height=e.height,h.width=h.height*s):(i(e.width)&&(h.width=e.width),i(e.height)&&(h.height=e.height)),this.renderCropBox())},getDataURL:function(h,s,a){var o,r,n,d,c,l,g,f,u,m,v;return this.cropped&&T.canvas&&(m=this.getData(),o=m.width,r=m.height,g=t.isPlainObject(h),g?(c=h.width||o,l=h.height||r):(a=s,s=h),n=g?c:o,d=g?l:r,f=t("<canvas>")[0],f.width=n,f.height=d,u=f.getContext("2d"),"image/jpeg"===s&&(u.fillStyle="#fff",u.fillRect(0,0,n,d)),u.drawImage.apply(u,function(){var t,i,e,h,s,a,n,d=p(this.$clone[0],this.image),l=d.width,f=d.height,u=[d],v=m.x,w=m.y;return-o>=v||v>l?v=t=e=s=0:0>=v?(e=-v,v=0,t=s=E(l,o+v)):l>=v&&(e=0,t=s=E(o,l-v)),0>=t||-r>=w||w>f?w=i=h=a=0:0>=w?(h=-w,w=0,i=a=E(f,r+w)):f>=w&&(h=0,i=a=E(r,f-w)),u.push(v,w,t,i),g&&(n=o/c,e/=n,h/=n,s/=n,a/=n),s>0&&a>0&&u.push(e,h,s,a),u}.call(this)),v=f.toDataURL.apply(f,function(){var t=[];return e(s)&&t.push(s),i(a)&&t.push(a),t}.call(this))),v||""},setAspectRatio:function(t){var i=this.options;this.disabled||h(t)||(i.aspectRatio=j(F(t))||NaN,this.built&&this.initCropBox())},setDragMode:function(t){var i=this.$canvas,e=!1,h=!1;if(this.ready&&!this.disabled){switch(t){case"crop":this.options.dragCrop?(e=!0,i.data(u,t)):h=!0;break;case"move":h=!0,i.data(u,t);break;default:i.removeData(u)}i.toggleClass(y,e).toggleClass("cropper-move",h)}}}),N.change=function(){var t,i=this.directive,e=this.image,h=this.container,s=h.width,a=h.height,o=this.cropBox,r=o.width,n=o.height,d=o.left,p=o.top,c=d+r,l=p+n,g=!0,f=this.options.aspectRatio,u={x:this.endX-this.startX,y:this.endY-this.startY};switch(f&&(u.X=u.y*f,u.Y=u.x/f),i){case"all":d+=u.x,p+=u.y;break;case"e":if(u.x>=0&&(c>=s||f&&(0>=p||l>=a))){g=!1;break}r+=u.x,f&&(n=r/f,p-=u.Y/2),0>r&&(i="w",r=0);break;case"n":if(u.y<=0&&(0>=p||f&&(0>=d||c>=s))){g=!1;break}n-=u.y,p+=u.y,f&&(r=n*f,d+=u.X/2),0>n&&(i="s",n=0);break;case"w":if(u.x<=0&&(0>=d||f&&(0>=p||l>=a))){g=!1;break}r-=u.x,d+=u.x,f&&(n=r/f,p+=u.Y/2),0>r&&(i="e",r=0);break;case"s":if(u.y>=0&&(l>=a||f&&(0>=d||c>=s))){g=!1;break}n+=u.y,f&&(r=n*f,d-=u.X/2),0>n&&(i="n",n=0);break;case"ne":if(f){if(u.y<=0&&(0>=p||c>=s)){g=!1;break}n-=u.y,p+=u.y,r=n*f}else u.x>=0?s>c?r+=u.x:u.y<=0&&0>=p&&(g=!1):r+=u.x,u.y<=0?p>0&&(n-=u.y,p+=u.y):(n-=u.y,p+=u.y);0>r&&0>n?(i="sw",n=0,r=0):0>r?(i="nw",r=0):0>n&&(i="se",n=0);break;case"nw":if(f){if(u.y<=0&&(0>=p||0>=d)){g=!1;break}n-=u.y,p+=u.y,r=n*f,d+=u.X}else u.x<=0?d>0?(r-=u.x,d+=u.x):u.y<=0&&0>=p&&(g=!1):(r-=u.x,d+=u.x),u.y<=0?p>0&&(n-=u.y,p+=u.y):(n-=u.y,p+=u.y);0>r&&0>n?(i="se",n=0,r=0):0>r?(i="ne",r=0):0>n&&(i="sw",n=0);break;case"sw":if(f){if(u.x<=0&&(0>=d||l>=a)){g=!1;break}r-=u.x,d+=u.x,n=r/f}else u.x<=0?d>0?(r-=u.x,d+=u.x):u.y>=0&&l>=a&&(g=!1):(r-=u.x,d+=u.x),u.y>=0?a>l&&(n+=u.y):n+=u.y;0>r&&0>n?(i="ne",n=0,r=0):0>r?(i="se",r=0):0>n&&(i="nw",n=0);break;case"se":if(f){if(u.x>=0&&(c>=s||l>=a)){g=!1;break}r+=u.x,n=r/f}else u.x>=0?s>c?r+=u.x:u.y>=0&&l>=a&&(g=!1):r+=u.x,u.y>=0?a>l&&(n+=u.y):n+=u.y;0>r&&0>n?(i="nw",n=0,r=0):0>r?(i="sw",r=0):0>n&&(i="ne",n=0);break;case"move":e.left+=u.x,e.top+=u.y,this.renderImage(!0),g=!1;break;case"zoom":this.zoom(function(t,i,e,h,s,a){return(R(s*s+a*a)-R(e*e+h*h))/R(t*t+i*i)}(e.width,e.height,j(this.startX-this.startX2),j(this.startY-this.startY2),j(this.endX-this.endX2),j(this.endY-this.endY2))),this.endX2=this.startX2,this.endY2=this.startY2,g=!1;break;case"crop":u.x&&u.y&&(t=this.$cropper.offset(),d=this.startX-t.left,p=this.startY-t.top,r=o.minWidth,n=o.minHeight,u.x>0?u.y>0?i="se":(i="ne",p-=n):u.y>0?(i="sw",d-=r):(i="nw",d-=r,p-=n),this.cropped||(this.cropped=!0,this.$cropBox.removeClass(b)))}g&&(o.width=r,o.height=n,o.left=d,o.top=p,this.directive=i,this.renderCropBox()),this.startX=this.endX,this.startY=this.endY},t.extend(c.prototype,N),c.DEFAULTS={aspectRatio:NaN,autoCropArea:.8,crop:null,preview:"",global:!0,responsive:!0,checkImageOrigin:!0,modal:!0,guides:!0,highlight:!0,background:!0,autoCrop:!0,dragCrop:!0,movable:!0,resizable:!0,rotatable:!0,zoomable:!0,touchDragZoom:!0,mouseWheelZoom:!0,minCropBoxWidth:0,minCropBoxHeight:0,minContainerWidth:300,minContainerHeight:150,build:null,built:null,dragstart:null,dragmove:null,dragend:null},c.setDefaults=function(i){t.extend(c.DEFAULTS,i)},c.TEMPLATE=function(t,i){return i=i.split(","),t.replace(/\d+/g,function(t){return i[t]})}('<0 6="5-container"><0 6="5-canvas"></0><0 6="5-cropbox"><1 6="5-viewer"></1><1 6="5-8 8-h"></1><1 6="5-8 8-v"></1><1 6="5-face" 3-2="all"></1><1 6="5-7 7-e" 3-2="e"></1><1 6="5-7 7-n" 3-2="n"></1><1 6="5-7 7-w" 3-2="w"></1><1 6="5-7 7-s" 3-2="s"></1><1 6="5-4 4-e" 3-2="e"></1><1 6="5-4 4-n" 3-2="n"></1><1 6="5-4 4-w" 3-2="w"></1><1 6="5-4 4-s" 3-2="s"></1><1 6="5-4 4-ne" 3-2="ne"></1><1 6="5-4 4-nw" 3-2="nw"></1><1 6="5-4 4-sw" 3-2="sw"></1><1 6="5-4 4-se" 3-2="se"></1></0></0>',"div,span,directive,data,point,cropper,class,line,dashed"),c.other=t.fn.cropper,t.fn.cropper=function(i){var e,a=s(arguments,1);return this.each(function(){var h,s=t(this),o=s.data("cropper");o||s.data("cropper",o=new c(this,i)),"string"==typeof i&&t.isFunction(h=o[i])&&(e=h.apply(o,a))}),h(e)?this:e},t.fn.cropper.Constructor=c,t.fn.cropper.setDefaults=c.setDefaults,t.fn.cropper.noConflict=function(){return t.fn.cropper=c.other,this}});